# API `/server`

The RESTful API for traders and brokers. Please visit [apiary](https://matthiola.docs.apiary.io/) for more details.

## Authentication

Matthiola uses [JWT](https://en.wikipedia.org/wiki/JSON_Web_Token), or JSON Web Token for authentication. Traders should send a request to sign a contract with the broker, then the broker will return the access token.

| Code | Name | Description | Value |
| ---- | ---- | ----------- | ----- |
| sub | Subject | Identifies the subject of the JWT. | Firm ID |
| aud | Audience | Identifies the recipients that the JWT is intended for. | Firm Name |
| exp | Expiration time | Identifies the expiration time on or after which the JWT must not be accepted for processing. The value should be in NumericDate format. | Defined according to the request |
| iat | Issued at | Identifies the time at which the JWT was issued. | The current time |
| jti | JWT ID | Case sensitive unique identifier of the token even among different issuers. | UUID |

### Sign a Contract

Sign a contract with the broker.

#### HTTP Request

`POST /server/api/v1/auth`

> Request

```json
{
    "firm_name": "Matthiola",
    "expires_at": "2018-08-22T16:52:23Z"
}
```

#### Request

| Param | Description |
| ----- | ----------- |
| firm_name | Name of firm to be signed |
| expires_at | Expire time in ISO 8601 |

> Response

```json
{
    "data": {
        "firm_id": 1,
        "firm_name": "Matthiola",
        "credit": 100,
        "token": "QWxhZGRpbjpvcGVuIHNlc2FtZQ=="
    }
}
```

#### Response

| Param | Description |
| ----- | ----------- |
| firm_id | ID of firm stored in the database |
| firm_name | Name of firm to be signed |
| credit | Credit of the firm |
| token | Access token generated by server |

### Validate

Validate the token generated by the broker.

#### HTTP Request

`GET /server/api/v1/auth`

#### Request

##### Headers

Authorization: Bearer `token`

> Response

```json
{
    "data": {
        "firm_id": 1,
        "firm_name": "Matthiola",
        "credit": 100,
        "token": "QWxhZGRpbjpvcGVuIHNlc2FtZQ=="
    }
}
```

#### Response

| Param | Description |
| ----- | ----------- |
| firm_id | ID of firm stored in the database |
| firm_name | Name of firm to be signed |
| credit | Credit of the firm |
| token | Access token generated by server |

## Trader

### List Orders

List your current open orders.

#### HTTP Request

`GET /server/api/v1/orders`

#### Parameters

| Param | Description | Required | Default |
| ----- | ----------- | -------- | ------- |
| futures_id | Specific futures | False | |
| trader_name | Specific trader | False | |
| status | Specific status | False | |
| page | Page number | False | 0 |

#### Request

##### Headers

Authorization: Bearer `token`

> Response

```json
{
    "count": 1,
    "data": [
        {
            "order_id": "cc8115fb-6b15-11e8-aebf-6a000223d540",
            "order_type": "LIMIT",
            "side": "SELL",
            "futures_id": "GC_SEP18",
            "firm": "Sender",
            "trader_name": "John Doe",
            "quantity": "14.21",
            "open_quantity": "14.21",
            "price": "50.01",
            "stop_price": "0",
            "status": "NEW",
            "created_at": "2018-06-08 20:25:07 +0800 CST",
            "updated_at": "2018-06-08 20:25:07 +0800 CST"
        }
    ],
    "page": 7,
    "total": 61
}
```

#### Response

| Param | Description |
| ----- | ----------- |
| count | Current count of data of orders |
| data | Array of data of orders |
| page | Page number |
| total | Total count of data of orders |

### List Trades

List your current open trades.

#### HTTP Request

`GET /server/api/v1/trades`

#### Parameters

| Param | Description | Required | Default |
| ----- | ----------- | -------- | ------- |
| futures_id | Specific futures | False | |
| trader_name | Specific trader | False | |
| page | Page number | False | 0 |

#### Request

##### Headers

Authorization: Bearer `token`

> Response

```json
{
    "count": 1,
    "data": [
        {
            "trade_id": "3bf4921d-68c0-11e8-9c81-6a000223d540",
            "quantity": "10",
            "price": "50",
            "futures_id": "GC_SEP18",
            "initiator": {
                "firm": "Matthiola",
                "side": "SELL",
                "trader": "John Doe"
            },
            "completion": {
                "firm": "Matthiola",
                "side": "BUY",
                "trader": "John Doe"
            },
            "trade_time": "2018-06-08 20:52:23 +0800 CST"
        }
    ],
    "page": 6,
    "total": 51
}
```

#### Response

| Param | Description |
| ----- | ----------- |
| count | Current count of data of trades |
| data | Array of data of trades |
| page | Page number |
| total | Total count of data of trades |

## Broker

### Sign as admin

#### HTTP Request

`POST /server/api/v1/admin/auth`

> Request

```json
{
    "name": "John Doe",
    "expires_at": "2018-08-22T16:52:23Z"
}
```

#### Request

| Param | Description |
| ----- | ----------- |
| name | Name of admin |
| expires_at | Expire time in ISO 8601 |

> Response

```json
{
    "data": {
        "name": "John Doe",
        "token": "QWxhZGRpbjpvcGVuIHNlc2FtZQ=="
    }
}
```

#### Response

| Param | Description |
| ----- | ----------- |
| fname | Name of admin |
| token | Admin access token generated by server |

### List Orders

List all orders.

#### HTTP Request

`GET /server/api/v1/admin/orders`

#### Parameters

| Param | Description | Required | Default |
| ----- | ----------- | -------- | ------- |
| page | Page number | False | 0 |

#### Request

##### Headers

Authorization: Bearer `admin token`

> Response

```json
{
    "count": 1,
    "data": [
        {
            "order_id": "cc8115fb-6b15-11e8-aebf-6a000223d540",
            "order_type": "LIMIT",
            "side": "SELL",
            "futures_id": "GC_SEP18",
            "firm": "Sender",
            "trader_name": "John Doe",
            "quantity": "14.21",
            "open_quantity": "14.21",
            "price": "50.01",
            "stop_price": "0",
            "status": "NEW",
            "created_at": "2018-06-08 20:25:07 +0800 CST",
            "updated_at": "2018-06-08 20:25:07 +0800 CST"
        }
    ],
    "page": 7,
    "total": 61
}
```

#### Response

| Param | Description |
| ----- | ----------- |
| count | Current count of data of orders |
| data | Array of data of orders |
| page | Page number |
| total | Total count of data of orders |

### List Trades

List all trades.

#### HTTP Request

`GET /server/api/v1/admin/trades`

#### Parameters

| Param | Description | Required | Default |
| ----- | ----------- | -------- | ------- |
| page | Page number | False | 0 |

#### Request

##### Headers

Authorization: Bearer `admin token`

> Response

```json
{
    "count": 1,
    "data": [
        {
            "trade_id": "3bf4921d-68c0-11e8-9c81-6a000223d540",
            "quantity": "10",
            "price": "50",
            "futures_id": "GC_SEP18",
            "initiator": {
                "firm": "Matthiola",
                "side": "SELL",
                "trader": "John Doe"
            },
            "completion": {
                "firm": "Matthiola",
                "side": "BUY",
                "trader": "John Doe"
            },
            "trade_time": "2018-06-08 20:52:23 +0800 CST"
        }
    ],
    "page": 6,
    "total": 51
}
```

#### Response

| Param | Description |
| ----- | ----------- |
| count | Current count of data of trades |
| data | Array of data of trades |
| page | Page number |
| total | Total count of data of trades |
